'------------Creator: Samu Lahti--------------
'----------Instrumentation Database----------
'--Run code for instrumentation database-----
'--------------Date: 03/2020-------
'------------------Rev.0-------------

Option Explicit   '<---- forces you to declare all your variables


'==========================================================================================================================
Private Sub Workbook_Open()
'==========================================================================================================================
'Function:  To Run code when instrumentation database is opened
'Version History:

Dim strDataBaseExcel As String, strDataBaseExcelSheetDATA As String, strDataBaseExcelSheetCABLES As String
Dim lColumn As Long, lRow As Long
Dim lLastRowOnCableList As Long, lCableTypeColumn As Long
Dim i As Long, lTrunkCableCount As Long
Dim strCellValue As String, strTrunkCableInfo As String


'Declare variables
strDataBaseExcel = "Instrumentation.xlsm"
strDataBaseExcelSheetDATA = "DATA"
strDataBaseExcelSheetCABLES = "CABLES"
lTrunkCableCount = 0
    
'Check what's the last row on database and cable list and save values to variables
Application.ScreenUpdating = False
lColumn = GetLastColumn(strDataBaseExcel, strDataBaseExcelSheetDATA, 3, "TRUNCK CABLE NBR") 'Find column where trunk cable number is located
lRow = GetLastRow(strDataBaseExcel, strDataBaseExcelSheetDATA, lColumn) + 1
lLastRowOnCableList = GetLastRow(strDataBaseExcel, strDataBaseExcelSheetCABLES, 1) + 1
    
'Print Trunk cables to CABLES sheet
For i = 4 To lRow
    strCellValue = GetValue(strDataBaseExcel, strDataBaseExcelSheetDATA, i, lColumn)
    Workbooks(strDataBaseExcel).Worksheets(2).Activate
    If IsError(Application.Match(Workbooks(strDataBaseExcel).Sheets(strDataBaseExcelSheetDATA).Cells(i, lColumn).Value, Range("A:A"), 0)) Then 'Check if cable is already on the list
        If strCellValue <> "" Then 'Check If value is not empty
            Workbooks(strDataBaseExcel).Worksheets(strDataBaseExcelSheetCABLES).Cells(lLastRowOnCableList, 1).Value = strCellValue
            lLastRowOnCableList = lLastRowOnCableList + 1 'Add value to variable to move on next row
            lTrunkCableCount = lTrunkCableCount + 1
        End If
    End If
Next i
        
lColumn = GetLastColumn(strDataBaseExcel, strDataBaseExcelSheetDATA, 3, "TRUNCK CABLE TYPE")
        
'Print Trunk cable cable type to CABLES sheet
For i = 1 To lTrunkCableCount
    strTrunkCableInfo = Workbooks(strDataBaseExcel).Worksheets(strDataBaseExcelSheetCABLES).Cells(i + 1, 1).Value
    strCellValue = Workbooks(strDataBaseExcel).Sheets(strDataBaseExcelSheetDATA).Cells(GetLastRow(strDataBaseExcel, strDataBaseExcelSheetDATA, GetLastColumn(strDataBaseExcel, strDataBaseExcelSheetDATA, 3, "TRUNCK CABLE NBR"), strTrunkCableInfo), lColumn).Value
    Workbooks(strDataBaseExcel).Worksheets(2).Activate
    If strCellValue <> "" Then 'Check If value is not empty
        Workbooks(strDataBaseExcel).Worksheets(strDataBaseExcelSheetCABLES).Cells(i + 1, GetLastColumn(strDataBaseExcel, strDataBaseExcelSheetCABLES, 1, "CABLE TYPE")).Value = strCellValue
    End If
Next i

lColumn = GetLastColumn(strDataBaseExcel, strDataBaseExcelSheetDATA, 3, "TRUNCK CABLE FROM")

'Print Trunk cable from info to CABLES sheet
For i = 1 To lTrunkCableCount
    strTrunkCableInfo = Workbooks(strDataBaseExcel).Worksheets(strDataBaseExcelSheetCABLES).Cells(i + 1, 1).Value
    strCellValue = Workbooks(strDataBaseExcel).Sheets(strDataBaseExcelSheetDATA).Cells(GetLastRow(strDataBaseExcel, strDataBaseExcelSheetDATA, GetLastColumn(strDataBaseExcel, strDataBaseExcelSheetDATA, 3, "TRUNCK CABLE NBR"), strTrunkCableInfo), lColumn).Value
    Workbooks(strDataBaseExcel).Worksheets(2).Activate
    If strCellValue <> "" Then 'Check If value is not empty
        Workbooks(strDataBaseExcel).Worksheets(strDataBaseExcelSheetCABLES).Cells(i + 1, GetLastColumn(strDataBaseExcel, strDataBaseExcelSheetCABLES, 1, "CABLE FROM")).Value = strCellValue
    End If
Next i
        
Application.ScreenUpdating = True
 
End Sub
'------------------ENDSUB----------------------


